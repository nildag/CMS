{% extends 'base.html' %}

{% load static %}

{% block content %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalles del Contenido</title>
    <link rel="stylesheet" href="{% static 'contenido/styles.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{{ contenido.titulo }}</title>
    <link rel="stylesheet" href="{% static 'contenido/styles.css' %}">
</head>
<body>
<div class="container">
    <div class="content-details">
        <h1>{{ contenido.titulo }}</h1>
        <p class="author">Creado por {{ contenido.autor.get_full_name }}, Publicado el {{ contenido.fecha_creacion|date:"F j, Y" }}</p>
        <div class="content-body">
            {{ contenido.cuerpo | safe }}
        </div>
    </div>

    <div class="content-rating text-center">
        <h2>Valoración Promedio</h2>
        <p>Puntuación Promedio: {{ contenido.puntuacion | floatformat:2 }}</p>
        <p>Número de Valoraciones: {{ contenido.numero_valoraciones }}</p>
    </div>

    {% if user.is_authenticated %}
    <div class="content-rating text-center">
        <h2>Valorar este Contenido</h2>
        <form method="post" action="{% url 'contenido:valorar_contenido' contenido.id %}" id="rating-form">
            {% csrf_token %}
            <label for="puntuacion">Puntuación (1-5):</label>
            <div class="star-rating">
                <span class="fa fa-star" onclick="rateContent(1)"></span>
                <span class="fa fa-star" onclick="rateContent(2)"></span>
                <span class="fa fa-star" onclick="rateContent(3)"></span>
                <span class="fa fa-star" onclick="rateContent(4)"></span>
                <span class="fa fa-star" onclick="rateContent(5)"></span>
                <input type="hidden" id="selectedRating" name="puntuacion" value="0">
            </div>
            <button type="button" class="btn btn-primary" onclick="submitRating()">Valorar</button>
        </form>
    </div>
    {% endif %}
</div>

<script>
    function rateContent(rating) {
        const stars = document.querySelectorAll(".fa-star");
        for (let i = 0; i < stars.length; i++) {
            if (i < rating) {
                stars[i].classList.add("checked");
            } else {
                stars[i].classList.remove("checked");
            }
        }
        document.getElementById("selectedRating").value = rating;
    }

    function submitRating() {
        const selectedRating = document.getElementById("selectedRating").value;
        if (selectedRating > 0) {
            document.getElementById("rating-form").submit();
        } else {
            alert("Por favor, selecciona una puntuación antes de valorar.");
        }
    }
</script>
</body>
</html>

{% endblock %}
